const _0x4f7a67=_0x339f;function _0x339f(_0x3ac1ee,_0xfdfa31){const _0x5d87b1=_0x5d87();return _0x339f=function(_0x339f93,_0x16568c){_0x339f93=_0x339f93-0xdb;let _0x24c521=_0x5d87b1[_0x339f93];return _0x24c521;},_0x339f(_0x3ac1ee,_0xfdfa31);}(function(_0x1bfb53,_0x29d9ee){const _0x366804=_0x339f,_0x4bef27=_0x1bfb53();while(!![]){try{const _0x4766bd=parseInt(_0x366804(0x12a))/0x1+-parseInt(_0x366804(0x124))/0x2+-parseInt(_0x366804(0xec))/0x3*(parseInt(_0x366804(0x126))/0x4)+-parseInt(_0x366804(0x127))/0x5+parseInt(_0x366804(0xe7))/0x6+-parseInt(_0x366804(0x125))/0x7*(-parseInt(_0x366804(0x109))/0x8)+-parseInt(_0x366804(0x11d))/0x9*(parseInt(_0x366804(0xe5))/0xa);if(_0x4766bd===_0x29d9ee)break;else _0x4bef27['push'](_0x4bef27['shift']());}catch(_0x4c0a53){_0x4bef27['push'](_0x4bef27['shift']());}}}(_0x5d87,0x31ce9),require('dotenv')[_0x4f7a67(0x10d)]());const express=require(_0x4f7a67(0x115)),cors=require('cors'),path=require(_0x4f7a67(0xdb)),jwt=require(_0x4f7a67(0xf4)),{GoogleSpreadsheet}=require(_0x4f7a67(0x105)),admin=require(_0x4f7a67(0x11e));function normalizeDigits(_0x2bd5e6){if(!_0x2bd5e6)return _0x2bd5e6;return _0x2bd5e6['replace'](/[\u0660-\u0669\u06F0-\u06F9]/g,_0x562ebe=>{const _0x2019f4=_0x562ebe['charCodeAt'](0x0);if(_0x2019f4>=0x660&&_0x2019f4<=0x669)return String(_0x2019f4-0x660);if(_0x2019f4>=0x6f0&&_0x2019f4<=0x6f9)return String(_0x2019f4-0x6f0);return _0x562ebe;});}let serviceAccount;try{serviceAccount=JSON[_0x4f7a67(0x123)](process[_0x4f7a67(0x100)][_0x4f7a67(0x122)]);}catch{console[_0x4f7a67(0x121)](_0x4f7a67(0xeb)),process[_0x4f7a67(0x119)](0x1);}admin['initializeApp']({'credential':admin[_0x4f7a67(0xfa)][_0x4f7a67(0x10e)](serviceAccount)});async function sendPushTo(_0x169719,_0x45bf2c,_0x201287,_0x3c10be={}){const _0x33af5a=_0x4f7a67,_0x51e9a9={'token':_0x169719,'notification':{'title':_0x45bf2c,'body':_0x201287},'android':{'priority':_0x33af5a(0x102),'notification':{'android_channel_id':_0x33af5a(0x114),'sound':_0x33af5a(0x114),'vibrate_timings':[0x64,0xc8,0x64]}},'data':_0x3c10be};try{await admin[_0x33af5a(0x11b)]()[_0x33af5a(0x10b)](_0x51e9a9),console[_0x33af5a(0xf2)]('âœ…\x20ØªÙ…\x20Ø§Ù„Ø¥Ø±Ø³Ø§Ù„\x20Ø¥Ù„Ù‰\x20'+_0x169719);}catch(_0x113bd3){console['error'](_0x33af5a(0xe2)+_0x169719+':',_0x113bd3);}}const app=express();app[_0x4f7a67(0xfb)](cors()),app[_0x4f7a67(0xfb)](express[_0x4f7a67(0xf6)]()),app[_0x4f7a67(0xfb)](express['static'](path[_0x4f7a67(0xf8)](__dirname,'public')));const {JWT_SECRET,SUPERVISOR_CODE,GOOGLE_SHEET_ID:SHEET_ID,GOOGLE_SERVICE_KEY}=process[_0x4f7a67(0x100)];(!JWT_SECRET||!SUPERVISOR_CODE||!SHEET_ID||!GOOGLE_SERVICE_KEY)&&(console[_0x4f7a67(0x121)]('âŒ\x20Ø¨Ø¹Ø¶\x20Ù…ØªØºÙŠØ±Ø§Øª\x20Ø§Ù„Ø¨ÙŠØ¦Ø©\x20Ù…ÙÙ‚ÙˆØ¯Ø©.'),process[_0x4f7a67(0x119)](0x1));function _0x5d87(){const _0x2f42b6=['indexOf','549mSOzwv','firebase-admin','allSettled','public','error','FIREBASE_SERVICE_ACCOUNT','parse','40624jkdlgX','1099uBCexo','16372LqZvCW','1072885oqRPSr','ÙƒÙˆØ¯\x20Ø§Ù„Ù…ÙˆØ¸Ù','slice','334915BPeQgL','set','/api/me','post','status','Login\x20failed','path','replace','forEach','12h','client_email','Ø§Ù„Ø§Ø³Ù…','verify','âŒ\x20ÙØ´Ù„\x20Ø§Ù„Ø¥Ø±Ø³Ø§Ù„\x20Ø¥Ù„Ù‰\x20','sign','filter','31530edVXts','authorization','1749630WeDrFN','find','/api/hwafez','get','âŒ\x20Ø®Ø·Ø£:\x20FIREBASE_SERVICE_ACCOUNT\x20ØºÙŠØ±\x20ØµØ§Ù„Ø­.','171tpLaqb','private_key','code','headerValues','Invalid\x20token','useServiceAccountAuth','log','/api/register-token','jsonwebtoken','map','json','Users','join','Sheet\x20\x22','credential','use','trim','/api/tqeem','user\x20and\x20token\x20required','/api/login','env','message','high','Attendance','/api/attendance','google-spreadsheet','user','\x22\x20ØºÙŠØ±\x20Ù…ÙˆØ¬ÙˆØ¯','sendFile','12128KFMcxF','/api/notify-all','send','body','config','cert','keys','PORT','loadHeaderRow','index.html','Bearer\x20','default','express','Forbidden','sheetsByTitle','Ø±Ù‚Ù…\x20Ø§Ù„Ù…ÙˆØ¸Ù','exit','getRows','messaging'];_0x5d87=function(){return _0x2f42b6;};return _0x5d87();}let sheetCreds;try{sheetCreds=JSON[_0x4f7a67(0x123)](GOOGLE_SERVICE_KEY);}catch{console[_0x4f7a67(0x121)]('âŒ\x20GOOGLE_SERVICE_KEY\x20Ù„ÙŠØ³\x20JSON\x20ØµØ§Ù„Ø­.'),process[_0x4f7a67(0x119)](0x1);}async function accessSheet(){const _0x3555af=_0x4f7a67,_0x52fdba=new GoogleSpreadsheet(SHEET_ID);return await _0x52fdba[_0x3555af(0xf1)]({'client_email':sheetCreds[_0x3555af(0xdf)],'private_key':sheetCreds[_0x3555af(0xed)][_0x3555af(0xdc)](/\\n/g,'\x0a')}),await _0x52fdba['loadInfo'](),_0x52fdba;}async function readSheet(_0x745b54){const _0x19cd1d=_0x4f7a67,_0x3f85bd=await accessSheet(),_0x3ce1c6=_0x3f85bd[_0x19cd1d(0x117)][_0x745b54];if(!_0x3ce1c6)throw new Error(_0x19cd1d(0xf9)+_0x745b54+_0x19cd1d(0x107));await _0x3ce1c6[_0x19cd1d(0x111)]();const _0x40e168=_0x3ce1c6[_0x19cd1d(0xef)],_0x387fcc=await _0x3ce1c6[_0x19cd1d(0x11a)](),_0xaaa5d4=_0x387fcc[_0x19cd1d(0xf5)](_0x24782d=>_0x40e168[_0x19cd1d(0xf5)](_0x466232=>_0x24782d[_0x466232]??''));return{'headers':_0x40e168,'data':_0xaaa5d4};}function authenticate(_0x593b39,_0x1ee361,_0xe620fe){const _0x2a6599=_0x4f7a67,_0x204529=_0x593b39['headers'][_0x2a6599(0xe6)];if(!_0x204529||!_0x204529['startsWith'](_0x2a6599(0x113)))return _0x1ee361[_0x2a6599(0x12e)](0x191)['json']({'error':'Unauthorized'});try{_0x593b39[_0x2a6599(0x106)]=jwt[_0x2a6599(0xe1)](_0x204529[_0x2a6599(0x129)](0x7),JWT_SECRET),_0xe620fe();}catch{return _0x1ee361[_0x2a6599(0x12e)](0x191)[_0x2a6599(0xf6)]({'error':_0x2a6599(0xf0)});}}app['post'](_0x4f7a67(0xff),async(_0x5c564d,_0x236483)=>{const _0x118159=_0x4f7a67;let {code:_0x32fdbd,pass:_0x420b06}=_0x5c564d[_0x118159(0x10c)];if(!_0x32fdbd||!_0x420b06)return _0x236483['status'](0x190)['json']({'error':'code\x20and\x20pass\x20required'});_0x32fdbd=normalizeDigits(String(_0x32fdbd)[_0x118159(0xfc)]()),_0x420b06=normalizeDigits(String(_0x420b06)['trim']());try{const {headers:_0x1077b4,data:_0x1cd57d}=await readSheet(_0x118159(0xf7)),_0x575c18=_0x1077b4[_0x118159(0x11c)](_0x118159(0x128)),_0x575247=_0x1077b4[_0x118159(0x11c)]('ÙƒÙ„Ù…Ø©\x20Ø§Ù„Ù…Ø±ÙˆØ±'),_0x56a57c=_0x1077b4['indexOf'](_0x118159(0xe0)),_0x32791d=_0x1cd57d[_0x118159(0xe8)](_0xe4beaa=>{const _0x20bf60=_0x118159,_0x5b5a9a=normalizeDigits(String(_0xe4beaa[_0x575c18]??'')[_0x20bf60(0xfc)]()),_0x510e01=normalizeDigits(String(_0xe4beaa[_0x575247]??'')['trim']());return _0x5b5a9a===_0x32fdbd&&_0x510e01===_0x420b06;});if(!_0x32791d)return _0x236483[_0x118159(0x12e)](0x191)['json']({'error':'Invalid\x20credentials'});const _0xd1bf53={'code':_0x32fdbd,'name':_0x32791d[_0x56a57c]},_0x305a56=jwt[_0x118159(0xe3)](_0xd1bf53,JWT_SECRET,{'expiresIn':_0x118159(0xde)});_0x236483[_0x118159(0xf6)]({'token':_0x305a56,'user':_0xd1bf53});}catch(_0x1126e4){console[_0x118159(0x121)](_0x1126e4),_0x236483[_0x118159(0x12e)](0x1f4)[_0x118159(0xf6)]({'error':_0x118159(0x12f)});}}),app[_0x4f7a67(0xea)](_0x4f7a67(0x12c),authenticate,async(_0x5e57ae,_0xd889a4)=>{const _0x273c0b=_0x4f7a67;try{const {headers:_0x5abcae,data:_0x49be46}=await readSheet(_0x273c0b(0xf7)),_0xf48879=_0x5abcae[_0x273c0b(0x11c)](_0x273c0b(0x128)),_0x239633=normalizeDigits(String(_0x5e57ae[_0x273c0b(0x106)][_0x273c0b(0xee)])[_0x273c0b(0xfc)]()),_0x1add66=_0x49be46['find'](_0x1f7a65=>normalizeDigits(String(_0x1f7a65[_0xf48879]??'')[_0x273c0b(0xfc)]())===_0x239633);if(!_0x1add66)return _0xd889a4['status'](0x194)[_0x273c0b(0xf6)]({'error':'User\x20not\x20found'});const _0x1ff0a9={};_0x5abcae[_0x273c0b(0xdd)]((_0x5e9ed2,_0x55af07)=>_0x1ff0a9[_0x5e9ed2]=_0x1add66[_0x55af07]??''),_0xd889a4[_0x273c0b(0xf6)]({'user':_0x1ff0a9});}catch(_0x1b4bed){console['error'](_0x1b4bed),_0xd889a4[_0x273c0b(0x12e)](0x1f4)[_0x273c0b(0xf6)]({'error':_0x1b4bed[_0x273c0b(0x101)]});}}),app[_0x4f7a67(0xea)](_0x4f7a67(0x104),authenticate,async(_0x42d73e,_0x25b48f)=>{const _0x17281d=_0x4f7a67;try{const {headers:_0x14b407,data:_0x3ad786}=await readSheet(_0x17281d(0x103)),_0xeb28d6=_0x14b407[_0x17281d(0x11c)](_0x17281d(0x118)),_0x2f53b5=normalizeDigits(String(_0x42d73e['user'][_0x17281d(0xee)])['trim']()),_0x4147bb=_0x3ad786[_0x17281d(0xe4)](_0xf2448a=>normalizeDigits(String(_0xf2448a[_0xeb28d6]??'')[_0x17281d(0xfc)]())===_0x2f53b5);_0x25b48f[_0x17281d(0xf6)]({'headers':_0x14b407,'data':_0x4147bb});}catch(_0x25cf14){console[_0x17281d(0x121)](_0x25cf14),_0x25b48f[_0x17281d(0x12e)](0x1f4)[_0x17281d(0xf6)]({'error':_0x25cf14[_0x17281d(0x101)]});}}),app[_0x4f7a67(0xea)](_0x4f7a67(0xe9),authenticate,async(_0x321669,_0xe294ec)=>{const _0x2191d4=_0x4f7a67;try{const {headers:_0x108072,data:_0x251b36}=await readSheet('hwafez'),_0x9a9ead=_0x108072[_0x2191d4(0x11c)](_0x2191d4(0x118)),_0x2c8ce8=normalizeDigits(String(_0x321669['user'][_0x2191d4(0xee)])[_0x2191d4(0xfc)]()),_0x2c6f85=_0x251b36['filter'](_0x13991f=>normalizeDigits(String(_0x13991f[_0x9a9ead]??'')[_0x2191d4(0xfc)]())===_0x2c8ce8);_0xe294ec[_0x2191d4(0xf6)]({'headers':_0x108072,'data':_0x2c6f85});}catch(_0x18f2ff){console[_0x2191d4(0x121)](_0x18f2ff),_0xe294ec[_0x2191d4(0x12e)](0x1f4)[_0x2191d4(0xf6)]({'error':_0x18f2ff[_0x2191d4(0x101)]});}}),app[_0x4f7a67(0xea)](_0x4f7a67(0xfd),authenticate,async(_0x7004f5,_0x372299)=>{const _0x16d238=_0x4f7a67;try{const {headers:_0x5ca3ab,data:_0x2a97f3}=await readSheet('tqeem'),_0x27090b=_0x5ca3ab[_0x16d238(0x11c)](_0x16d238(0x118)),_0x1eb1c6=normalizeDigits(String(_0x7004f5[_0x16d238(0x106)][_0x16d238(0xee)])[_0x16d238(0xfc)]()),_0x3e1d18=_0x2a97f3[_0x16d238(0xe4)](_0x572ec4=>normalizeDigits(String(_0x572ec4[_0x27090b]??'')[_0x16d238(0xfc)]())===_0x1eb1c6);_0x372299['json']({'headers':_0x5ca3ab,'data':_0x3e1d18});}catch(_0x2d5157){console[_0x16d238(0x121)](_0x2d5157),_0x372299[_0x16d238(0x12e)](0x1f4)[_0x16d238(0xf6)]({'error':_0x2d5157['message']});}});const tokens=new Map();app[_0x4f7a67(0x12d)](_0x4f7a67(0xf3),(_0x374a15,_0x41bece)=>{const _0x242a61=_0x4f7a67,{user:_0x17e047,token:_0x4800a9}=_0x374a15[_0x242a61(0x10c)];if(!_0x17e047||!_0x4800a9)return _0x41bece[_0x242a61(0x12e)](0x190)['json']({'error':_0x242a61(0xfe)});tokens[_0x242a61(0x12b)](_0x4800a9,_0x17e047),_0x41bece[_0x242a61(0xf6)]({'success':!![]});}),app['post'](_0x4f7a67(0x10a),authenticate,async(_0x37e4e2,_0x3f28b2)=>{const _0x5e6e67=_0x4f7a67;if(_0x37e4e2[_0x5e6e67(0x106)][_0x5e6e67(0xee)]!==SUPERVISOR_CODE)return _0x3f28b2['status'](0x193)[_0x5e6e67(0xf6)]({'error':_0x5e6e67(0x116)});const {title:_0x133cb5,body:_0xbb27bf}=_0x37e4e2['body'],_0x5cea9c=Array['from'](tokens[_0x5e6e67(0x10f)]());await Promise[_0x5e6e67(0x11f)](_0x5cea9c[_0x5e6e67(0xf5)](_0x2507ff=>sendPushTo(_0x2507ff,_0x133cb5,_0xbb27bf))),_0x3f28b2[_0x5e6e67(0xf6)]({'success':!![]});}),app[_0x4f7a67(0xea)](/.*/,(_0x38ca46,_0x1783b4)=>_0x1783b4[_0x4f7a67(0x108)](path['join'](__dirname,_0x4f7a67(0x120),_0x4f7a67(0x112))));const PORT=process[_0x4f7a67(0x100)][_0x4f7a67(0x110)]||0xbb8;app['listen'](PORT,()=>console[_0x4f7a67(0xf2)]('ðŸš€\x20Ø§Ù„Ø®Ø§Ø¯Ù…\x20ÙŠØ¹Ù…Ù„\x20Ø¹Ù„Ù‰\x20'+PORT));
