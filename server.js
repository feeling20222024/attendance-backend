const _0x3c1f31=_0x3bff;(function(_0xa1bf26,_0x39afff){const _0x10dcce=_0x3bff,_0x36db2e=_0xa1bf26();while(!![]){try{const _0x561d6d=-parseInt(_0x10dcce(0x106))/0x1+parseInt(_0x10dcce(0x101))/0x2+parseInt(_0x10dcce(0xee))/0x3+parseInt(_0x10dcce(0xe2))/0x4+-parseInt(_0x10dcce(0xe8))/0x5+parseInt(_0x10dcce(0xfc))/0x6*(-parseInt(_0x10dcce(0xde))/0x7)+-parseInt(_0x10dcce(0xc1))/0x8;if(_0x561d6d===_0x39afff)break;else _0x36db2e['push'](_0x36db2e['shift']());}catch(_0x8e63ec){_0x36db2e['push'](_0x36db2e['shift']());}}}(_0x3a36,0x22d03),require(_0x3c1f31(0xce))[_0x3c1f31(0xe9)]());const express=require(_0x3c1f31(0xf4)),cors=require(_0x3c1f31(0xd6)),path=require(_0x3c1f31(0xe0)),jwt=require(_0x3c1f31(0xf2)),{GoogleSpreadsheet}=require(_0x3c1f31(0xc5)),admin=require(_0x3c1f31(0xbb));function normalizeDigits(_0x5c5ad0){const _0x23b550=_0x3c1f31;if(!_0x5c5ad0)return _0x5c5ad0;return _0x5c5ad0[_0x23b550(0xcd)](/[\u0660-\u0669\u06F0-\u06F9]/g,_0x553751=>{const _0xf94df0=_0x553751['charCodeAt'](0x0);if(_0xf94df0>=0x660&&_0xf94df0<=0x669)return String(_0xf94df0-0x660);if(_0xf94df0>=0x6f0&&_0xf94df0<=0x6f9)return String(_0xf94df0-0x6f0);return _0x553751;});}let serviceAccount;try{serviceAccount=JSON['parse'](process[_0x3c1f31(0x102)][_0x3c1f31(0x10b)]);}catch{console[_0x3c1f31(0xe3)](_0x3c1f31(0xfe)),process[_0x3c1f31(0x10e)](0x1);}admin[_0x3c1f31(0xf6)]({'credential':admin[_0x3c1f31(0xfd)][_0x3c1f31(0x10f)](serviceAccount)});async function sendPushTo(_0x3baefa,_0x579e57,_0x7d6b1c,_0xf259be={}){const _0x2d52a1=_0x3c1f31,_0x447745={'token':_0x3baefa,'notification':{'title':_0x579e57,'body':_0x7d6b1c},'android':{'ttl':0xa4cb800,'priority':_0x2d52a1(0xc0),'notification':{'channel_id':_0x2d52a1(0x10a),'sound':'default'}},'data':_0xf259be};try{const _0x1fac1c=await admin[_0x2d52a1(0xf5)]()['send'](_0x447745);return console[_0x2d52a1(0x103)](_0x2d52a1(0xeb),_0x1fac1c),_0x1fac1c;}catch(_0x459137){console[_0x2d52a1(0xe3)](_0x2d52a1(0xca),_0x3baefa,_0x459137);throw _0x459137;}}const app=express();app[_0x3c1f31(0xf8)](cors()),app['use'](express['json']()),app[_0x3c1f31(0xf8)](express['static'](path[_0x3c1f31(0xe7)](__dirname,_0x3c1f31(0xe1))));function _0x3bff(_0x33ac44,_0x155d4e){const _0x3a366f=_0x3a36();return _0x3bff=function(_0x3bff3f,_0x52bb29){_0x3bff3f=_0x3bff3f-0xb8;let _0x282625=_0x3a366f[_0x3bff3f];return _0x282625;},_0x3bff(_0x33ac44,_0x155d4e);}const {JWT_SECRET,SUPERVISOR_CODE,GOOGLE_SHEET_ID:SHEET_ID,GOOGLE_SERVICE_KEY}=process[_0x3c1f31(0x102)];(!JWT_SECRET||!SUPERVISOR_CODE||!SHEET_ID||!GOOGLE_SERVICE_KEY)&&(console[_0x3c1f31(0xe3)]('âŒ\x20Ø¨Ø¹Ø¶\x20Ù…ØªØºÙŠØ±Ø§Øª\x20Ø§Ù„Ø¨ÙŠØ¦Ø©\x20Ù…ÙÙ‚ÙˆØ¯Ø©.'),process[_0x3c1f31(0x10e)](0x1));let sheetCreds;try{sheetCreds=JSON[_0x3c1f31(0xc7)](GOOGLE_SERVICE_KEY);}catch{console[_0x3c1f31(0xe3)](_0x3c1f31(0xc2)),process[_0x3c1f31(0x10e)](0x1);}async function accessSheet(){const _0x2a4562=_0x3c1f31,_0x2e9d8e=new GoogleSpreadsheet(SHEET_ID);return await _0x2e9d8e[_0x2a4562(0x109)]({'client_email':sheetCreds['client_email'],'private_key':sheetCreds[_0x2a4562(0xc9)]['replace'](/\\n/g,'\x0a')}),await _0x2e9d8e[_0x2a4562(0x104)](),_0x2e9d8e;}async function readSheet(_0x44d306){const _0x5cd548=_0x3c1f31,_0x592d9d=await accessSheet(),_0xc514fe=_0x592d9d[_0x5cd548(0xe5)][_0x44d306];if(!_0xc514fe)throw new Error(_0x5cd548(0xdf)+_0x44d306+_0x5cd548(0xec));await _0xc514fe[_0x5cd548(0xd1)]();const _0x54cd02=_0xc514fe[_0x5cd548(0xc3)],_0x8279b7=await _0xc514fe[_0x5cd548(0xd9)](),_0x76a0d2=_0x8279b7[_0x5cd548(0xe4)](_0x5e913d=>_0x54cd02['map'](_0x10c141=>_0x5e913d[_0x10c141]??''));return{'headers':_0x54cd02,'data':_0x76a0d2};}function authenticate(_0xe7b79a,_0x343441,_0x20f21a){const _0x5c1141=_0x3c1f31,_0x390b3d=_0xe7b79a[_0x5c1141(0x100)][_0x5c1141(0xed)];if(!_0x390b3d||!_0x390b3d['startsWith']('Bearer\x20'))return _0x343441[_0x5c1141(0x113)](0x191)['json']({'error':_0x5c1141(0xe6)});try{_0xe7b79a[_0x5c1141(0xef)]=jwt[_0x5c1141(0x112)](_0x390b3d[_0x5c1141(0xdb)](0x7),JWT_SECRET),_0x20f21a();}catch{return _0x343441[_0x5c1141(0x113)](0x191)[_0x5c1141(0xc6)]({'error':_0x5c1141(0x105)});}}app[_0x3c1f31(0xfb)]('/api/login',async(_0xcc1654,_0x57d53b)=>{const _0x1c2b8b=_0x3c1f31;let {code:_0x46127b,pass:_0x32c025}=_0xcc1654['body'];if(!_0x46127b||!_0x32c025)return _0x57d53b[_0x1c2b8b(0x113)](0x190)[_0x1c2b8b(0xc6)]({'error':_0x1c2b8b(0xd7)});_0x46127b=normalizeDigits(String(_0x46127b)['trim']()),_0x32c025=normalizeDigits(String(_0x32c025)[_0x1c2b8b(0xd3)]());try{const {headers:_0x114bec,data:_0x3b17a7}=await readSheet('Users'),_0x4a6a87=_0x114bec[_0x1c2b8b(0xea)]('ÙƒÙˆØ¯\x20Ø§Ù„Ù…ÙˆØ¸Ù'),_0x4a349c=_0x114bec['indexOf'](_0x1c2b8b(0xc4)),_0x40a20e=_0x114bec[_0x1c2b8b(0xea)](_0x1c2b8b(0x111)),_0x15fdb7=_0x3b17a7[_0x1c2b8b(0xf7)](_0x15cda2=>{const _0x2b5855=_0x1c2b8b,_0x3d9f44=normalizeDigits(String(_0x15cda2[_0x4a6a87]??'')['trim']()),_0x3a9340=normalizeDigits(String(_0x15cda2[_0x4a349c]??'')[_0x2b5855(0xd3)]());return _0x3d9f44===_0x46127b&&_0x3a9340===_0x32c025;});if(!_0x15fdb7)return _0x57d53b[_0x1c2b8b(0x113)](0x191)['json']({'error':_0x1c2b8b(0xbd)});const _0x83adb7={'code':_0x46127b,'name':_0x15fdb7[_0x40a20e]},_0x5d5309=jwt[_0x1c2b8b(0xd2)](_0x83adb7,JWT_SECRET,{'expiresIn':'12h'});_0x57d53b['json']({'token':_0x5d5309,'user':_0x83adb7});}catch(_0xe68063){console[_0x1c2b8b(0xe3)](_0xe68063),_0x57d53b[_0x1c2b8b(0x113)](0x1f4)['json']({'error':_0x1c2b8b(0xf9)});}}),app[_0x3c1f31(0xbe)](_0x3c1f31(0xf0),authenticate,async(_0x51bd05,_0x5a0a52)=>{const _0x3ec96a=_0x3c1f31;try{const {headers:_0x5bd561,data:_0xdaca48}=await readSheet(_0x3ec96a(0xda)),_0x5e0cd0=_0x5bd561[_0x3ec96a(0xea)]('ÙƒÙˆØ¯\x20Ø§Ù„Ù…ÙˆØ¸Ù'),_0x1249e4=normalizeDigits(String(_0x51bd05[_0x3ec96a(0xef)][_0x3ec96a(0xb9)])[_0x3ec96a(0xd3)]()),_0x16c3de=_0xdaca48[_0x3ec96a(0xf7)](_0x5d176c=>normalizeDigits(String(_0x5d176c[_0x5e0cd0]??'')[_0x3ec96a(0xd3)]())===_0x1249e4);if(!_0x16c3de)return _0x5a0a52[_0x3ec96a(0x113)](0x194)[_0x3ec96a(0xc6)]({'error':_0x3ec96a(0xd4)});const _0x5905ed={};_0x5bd561[_0x3ec96a(0xbf)]((_0x3c091f,_0x1475c0)=>_0x5905ed[_0x3c091f]=_0x16c3de[_0x1475c0]??''),_0x5a0a52[_0x3ec96a(0xc6)]({'user':_0x5905ed});}catch(_0x50b127){console[_0x3ec96a(0xe3)](_0x50b127),_0x5a0a52[_0x3ec96a(0x113)](0x1f4)[_0x3ec96a(0xc6)]({'error':_0x50b127[_0x3ec96a(0xf1)]});}}),app[_0x3c1f31(0xbe)]('/api/attendance',authenticate,async(_0xb1edec,_0x5559c0)=>{const _0x5634be=_0x3c1f31;try{const {headers:_0x2a9b74,data:_0x199691}=await readSheet(_0x5634be(0x10d)),_0x55e493=_0x2a9b74[_0x5634be(0xea)](_0x5634be(0x110)),_0x4bd6c1=normalizeDigits(String(_0xb1edec[_0x5634be(0xef)][_0x5634be(0xb9)])[_0x5634be(0xd3)]()),_0x65ad48=_0x199691[_0x5634be(0xd8)](_0x1a2f54=>normalizeDigits(String(_0x1a2f54[_0x55e493]??'')[_0x5634be(0xd3)]())===_0x4bd6c1);_0x5559c0[_0x5634be(0xc6)]({'headers':_0x2a9b74,'data':_0x65ad48});}catch(_0x28d86b){console[_0x5634be(0xe3)](_0x28d86b),_0x5559c0[_0x5634be(0x113)](0x1f4)[_0x5634be(0xc6)]({'error':_0x28d86b[_0x5634be(0xf1)]});}}),app[_0x3c1f31(0xbe)](_0x3c1f31(0xcb),authenticate,async(_0x2a7bd5,_0x162c9b)=>{const _0x511d4e=_0x3c1f31;try{const {headers:_0x5c4764,data:_0x353512}=await readSheet(_0x511d4e(0xcf)),_0x5a531c=_0x5c4764['indexOf']('Ø±Ù‚Ù…\x20Ø§Ù„Ù…ÙˆØ¸Ù'),_0x4838a8=normalizeDigits(String(_0x2a7bd5['user'][_0x511d4e(0xb9)])['trim']()),_0x2296d4=_0x353512[_0x511d4e(0xd8)](_0x439631=>normalizeDigits(String(_0x439631[_0x5a531c]??'')['trim']())===_0x4838a8);_0x162c9b[_0x511d4e(0xc6)]({'headers':_0x5c4764,'data':_0x2296d4});}catch(_0x314a65){console['error'](_0x314a65),_0x162c9b[_0x511d4e(0x113)](0x1f4)['json']({'error':_0x314a65['message']});}}),app[_0x3c1f31(0xbe)](_0x3c1f31(0xba),authenticate,async(_0xe4cbeb,_0x274e24)=>{const _0x5cc1da=_0x3c1f31;try{const {headers:_0x5b9753,data:_0x15662e}=await readSheet(_0x5cc1da(0xd5)),_0x2f13b3=_0x5b9753[_0x5cc1da(0xea)](_0x5cc1da(0x110)),_0x4dc92a=normalizeDigits(String(_0xe4cbeb[_0x5cc1da(0xef)]['code'])[_0x5cc1da(0xd3)]()),_0x162de4=_0x15662e[_0x5cc1da(0xd8)](_0x27aa55=>normalizeDigits(String(_0x27aa55[_0x2f13b3]??'')[_0x5cc1da(0xd3)]())===_0x4dc92a);_0x274e24['json']({'headers':_0x5b9753,'data':_0x162de4});}catch(_0x11c772){console['error'](_0x11c772),_0x274e24[_0x5cc1da(0x113)](0x1f4)[_0x5cc1da(0xc6)]({'error':_0x11c772[_0x5cc1da(0xf1)]});}});const tokens=new Set();app[_0x3c1f31(0xfb)]('/api/register-token',(_0x2dfe09,_0x2e3512)=>{const _0x270e43=_0x3c1f31,{user:_0x1aa607,token:_0x5273cf}=_0x2dfe09['body'];if(!_0x1aa607||!_0x5273cf)return _0x2e3512[_0x270e43(0x113)](0x190)[_0x270e43(0xc6)]({'error':_0x270e43(0xb8)});tokens[_0x270e43(0x10c)](_0x5273cf),_0x2e3512['json']({'success':!![]});}),app[_0x3c1f31(0xfb)]('/api/notify-all',authenticate,async(_0x545331,_0x34d84c)=>{const _0x4fec67=_0x3c1f31;if(_0x545331[_0x4fec67(0xef)]['code']!==SUPERVISOR_CODE)return _0x34d84c['status'](0x193)[_0x4fec67(0xc6)]({'error':_0x4fec67(0xf3)});const {title:_0x14f6fd,body:_0x3b4ef3}=_0x545331[_0x4fec67(0xfa)],_0x37cd18=Array[_0x4fec67(0xdc)](tokens);await Promise[_0x4fec67(0xd0)](_0x37cd18[_0x4fec67(0xe4)](_0x1fa992=>sendPushTo(_0x1fa992,_0x14f6fd,_0x3b4ef3))),_0x34d84c[_0x4fec67(0xc6)]({'success':!![]});}),app['get'](_0x3c1f31(0xc8),(_0x57e02e,_0x2e1bc5)=>{const _0x377d9a=_0x3c1f31;_0x2e1bc5[_0x377d9a(0xc6)]({'latest':_0x377d9a(0xcc),'updateUrl':_0x377d9a(0xbc)});}),app[_0x3c1f31(0xbe)](/.*/,(_0xcc3d56,_0x38b9ca)=>_0x38b9ca[_0x3c1f31(0x107)](path[_0x3c1f31(0xe7)](__dirname,_0x3c1f31(0xe1),_0x3c1f31(0x108))));const PORT=process[_0x3c1f31(0x102)][_0x3c1f31(0xff)]||0xbb8;function _0x3a36(){const _0x28aa95=['cert','Ø±Ù‚Ù…\x20Ø§Ù„Ù…ÙˆØ¸Ù','Ø§Ù„Ø§Ø³Ù…','verify','status','user\x20and\x20token\x20required','code','/api/tqeem','firebase-admin','https://play.google.com/store/apps/details?id=com.example.app','Invalid\x20credentials','get','forEach','high','1619032NyXcXc','âŒ\x20GOOGLE_SERVICE_KEY\x20Ù„ÙŠØ³\x20JSON\x20ØµØ§Ù„Ø­.','headerValues','ÙƒÙ„Ù…Ø©\x20Ø§Ù„Ù…Ø±ÙˆØ±','google-spreadsheet','json','parse','/api/latest-version','private_key','âŒ\x20Failed\x20to\x20send\x20push\x20to','/api/hwafez','1.0.0','replace','dotenv','hwafez','allSettled','loadHeaderRow','sign','trim','User\x20not\x20found','tqeem','cors','code\x20and\x20pass\x20required','filter','getRows','Users','slice','from','listen','14niCzYc','Sheet\x20\x22','path','public','634544wSMgRz','error','map','sheetsByTitle','Unauthorized','join','557565sxISlO','config','indexOf','âœ…\x20Push\x20sent:','\x22\x20ØºÙŠØ±\x20Ù…ÙˆØ¬ÙˆØ¯','authorization','408609yNGJMU','user','/api/me','message','jsonwebtoken','Forbidden','express','messaging','initializeApp','find','use','Login\x20failed','body','post','19182lolMWd','credential','âŒ\x20Ø®Ø·Ø£:\x20FIREBASE_SERVICE_ACCOUNT\x20ØºÙŠØ±\x20ØµØ§Ù„Ø­.','PORT','headers','554096mBtHRe','env','log','loadInfo','Invalid\x20token','109006NyfSkh','sendFile','index.html','useServiceAccountAuth','default','FIREBASE_SERVICE_ACCOUNT','add','Attendance','exit'];_0x3a36=function(){return _0x28aa95;};return _0x3a36();}app[_0x3c1f31(0xdd)](PORT,()=>console[_0x3c1f31(0x103)]('ðŸš€\x20Ø§Ù„Ø®Ø§Ø¯Ù…\x20ÙŠØ¹Ù…Ù„\x20Ø¹Ù„Ù‰\x20'+PORT));
