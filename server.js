const _0x372a40=_0xf7b9;(function(_0x657712,_0x880bcf){const _0x11d659=_0xf7b9,_0x1343d9=_0x657712();while(!![]){try{const _0x345bc3=-parseInt(_0x11d659(0x8c))/0x1+parseInt(_0x11d659(0x9f))/0x2*(parseInt(_0x11d659(0x8e))/0x3)+parseInt(_0x11d659(0xb3))/0x4*(-parseInt(_0x11d659(0x88))/0x5)+-parseInt(_0x11d659(0xba))/0x6+parseInt(_0x11d659(0xd4))/0x7+parseInt(_0x11d659(0xbc))/0x8*(parseInt(_0x11d659(0x9e))/0x9)+parseInt(_0x11d659(0xa6))/0xa*(-parseInt(_0x11d659(0xd0))/0xb);if(_0x345bc3===_0x880bcf)break;else _0x1343d9['push'](_0x1343d9['shift']());}catch(_0x2727a6){_0x1343d9['push'](_0x1343d9['shift']());}}}(_0x2809,0x1d685),require(_0x372a40(0xc3))['config']());const APP_VERSION=process['env']['APP_VERSION']||_0x372a40(0x8b),express=require(_0x372a40(0x84)),cors=require(_0x372a40(0x8d)),path=require(_0x372a40(0xb6)),jwt=require(_0x372a40(0xa3)),{GoogleSpreadsheet}=require(_0x372a40(0xcf)),admin=require(_0x372a40(0xc8));function normalizeDigits(_0x40eecb){const _0x287832=_0x372a40;if(!_0x40eecb)return _0x40eecb;return _0x40eecb[_0x287832(0xae)](/[\u0660-\u0669\u06F0-\u06F9]/g,_0x280c70=>{const _0x2828c7=_0x280c70['charCodeAt'](0x0);if(_0x2828c7>=0x660&&_0x2828c7<=0x669)return String(_0x2828c7-0x660);if(_0x2828c7>=0x6f0&&_0x2828c7<=0x6f9)return String(_0x2828c7-0x6f0);return _0x280c70;});}function _0xf7b9(_0x54a96e,_0x268918){const _0x280951=_0x2809();return _0xf7b9=function(_0xf7b9b0,_0x122a55){_0xf7b9b0=_0xf7b9b0-0x7c;let _0x3bbccc=_0x280951[_0xf7b9b0];return _0x3bbccc;},_0xf7b9(_0x54a96e,_0x268918);}let serviceAccount;try{serviceAccount=JSON[_0x372a40(0x81)](process[_0x372a40(0x95)][_0x372a40(0xac)]);}catch{console['error'](_0x372a40(0x92)),process['exit'](0x1);}admin[_0x372a40(0x93)]({'credential':admin[_0x372a40(0xc7)]['cert'](serviceAccount)});async function sendPushTo(_0x53bde2,_0x439933,_0x20be5e,_0x380514={}){const _0x16fdb9=_0x372a40,_0x46034b={'token':_0x53bde2,'notification':{'title':_0x439933,'body':_0x20be5e},'android':{'ttl':_0x16fdb9(0xbe),'priority':_0x16fdb9(0xd6),'notification':{'android_channel_id':_0x16fdb9(0x9d),'sound':_0x16fdb9(0x9d),'vibrate_timings':[0x64,0xc8,0x64]}},'data':_0x380514};try{const _0x1417bf=await admin['messaging']()[_0x16fdb9(0x9a)](_0x46034b);console[_0x16fdb9(0xab)](_0x16fdb9(0xa4)+_0x53bde2+':\x20'+_0x1417bf);}catch(_0x3c8a6b){console[_0x16fdb9(0xbb)](_0x16fdb9(0x94)+_0x53bde2+':',_0x3c8a6b);}}function _0x2809(){const _0x52df2f=['listen','Attendance','join','1071378QKIUEk','error','56RODxra','/api/tqeem','172800s','Ø±Ù‚Ù…\x20Ø§Ù„Ù…ÙˆØ¸Ù','headerValues','body','verify','dotenv','/api/register-token','PORT','filter','credential','firebase-admin','loadInfo','code','map','trim','post','client_email','google-spreadsheet','1617VgYmhS','tqeem','\x22\x20ØºÙŠØ±\x20Ù…ÙˆØ¬ÙˆØ¯','authorization','1516809qXXykD','message','high','indexOf','sendFile','exit','allSettled','user','public','/api/notify-all','startsWith','parse','/api/notifications','static','express','Invalid\x20credentials','Ø§Ù„Ø§Ø³Ù…','useServiceAccountAuth','10uyMhlu','Login\x20failed','âŒ\x20GOOGLE_SERVICE_KEY\x20Ù„ÙŠØ³\x20JSON\x20ØµØ§Ù„Ø­.','1.0.7','4524AQCvpj','cors','125889xFDiBc','length','Unauthorized','/api/attendance','âŒ\x20Ø®Ø·Ø£:\x20FIREBASE_SERVICE_ACCOUNT\x20ØºÙŠØ±\x20ØµØ§Ù„Ø­.','initializeApp','âŒ\x20ÙØ´Ù„\x20Ø§Ù„Ø¥Ø±Ø³Ø§Ù„\x20Ø¥Ù„Ù‰\x20','env','headers','use','unshift','user\x20and\x20token\x20required','send','ðŸš€\x20Ø§Ù„Ø®Ø§Ø¯Ù…\x20ÙŠØ¹Ù…Ù„\x20Ø¹Ù„Ù‰\x20','Users','default','228519czbdwo','6qrMGEO','get','toString','Invalid\x20token','jsonwebtoken','âœ…\x20ØªÙ…\x20Ø§Ù„Ø¥Ø±Ø³Ø§Ù„\x20Ø¥Ù„Ù‰\x20','from','6490BgrzJn','private_key','ÙƒÙˆØ¯\x20Ø§Ù„Ù…ÙˆØ¸Ù','find','/api/hwafez','log','FIREBASE_SERVICE_ACCOUNT','status','replace','ØªÙ†Ø¨ÙŠÙ‡Ø§Øª\x20ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§Øª\x20Ø¹Ø§Ù…Ø©\x20Ù„Ø¬Ù…ÙŠØ¹\x20Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ†','/api/login','json','loadHeaderRow','242740fWibZj','keys','Bearer\x20','path'];_0x2809=function(){return _0x52df2f;};return _0x2809();}const app=express();app[_0x372a40(0x97)](cors()),app[_0x372a40(0x97)](express[_0x372a40(0xb1)]()),app[_0x372a40(0x97)](express[_0x372a40(0x83)](path['join'](__dirname,_0x372a40(0x7e))));const {JWT_SECRET,SUPERVISOR_CODE,GOOGLE_SHEET_ID:SHEET_ID,GOOGLE_SERVICE_KEY}=process[_0x372a40(0x95)];(!JWT_SECRET||!SUPERVISOR_CODE||!SHEET_ID||!GOOGLE_SERVICE_KEY)&&(console[_0x372a40(0xbb)]('âŒ\x20Ø¨Ø¹Ø¶\x20Ù…ØªØºÙŠØ±Ø§Øª\x20Ø§Ù„Ø¨ÙŠØ¦Ø©\x20Ù…ÙÙ‚ÙˆØ¯Ø©.'),process[_0x372a40(0xd9)](0x1));let sheetCreds;try{sheetCreds=JSON[_0x372a40(0x81)](GOOGLE_SERVICE_KEY);}catch{console['error'](_0x372a40(0x8a)),process[_0x372a40(0xd9)](0x1);}async function accessSheet(){const _0x40bd54=_0x372a40,_0x5a5534=new GoogleSpreadsheet(SHEET_ID);return await _0x5a5534[_0x40bd54(0x87)]({'client_email':sheetCreds[_0x40bd54(0xce)],'private_key':sheetCreds[_0x40bd54(0xa7)][_0x40bd54(0xae)](/\\n/g,'\x0a')}),await _0x5a5534[_0x40bd54(0xc9)](),_0x5a5534;}async function readSheet(_0xca1fe6){const _0x7e47ff=_0x372a40,_0x59c655=await accessSheet(),_0x4dcf46=_0x59c655['sheetsByTitle'][_0xca1fe6];if(!_0x4dcf46)throw new Error('Sheet\x20\x22'+_0xca1fe6+_0x7e47ff(0xd2));await _0x4dcf46[_0x7e47ff(0xb2)]();const _0x377de4=_0x4dcf46[_0x7e47ff(0xc0)],_0x11346d=await _0x4dcf46['getRows'](),_0x40edde=_0x11346d['map'](_0x284e92=>_0x377de4['map'](_0x9aacfd=>_0x284e92[_0x9aacfd]??''));return{'headers':_0x377de4,'data':_0x40edde};}function authenticate(_0x21951f,_0x3305cd,_0x271d43){const _0x433715=_0x372a40,_0x7fcdf2=_0x21951f[_0x433715(0x96)][_0x433715(0xd3)];if(!_0x7fcdf2||!_0x7fcdf2[_0x433715(0x80)](_0x433715(0xb5)))return _0x3305cd[_0x433715(0xad)](0x191)[_0x433715(0xb1)]({'error':_0x433715(0x90)});try{_0x21951f[_0x433715(0x7d)]=jwt[_0x433715(0xc2)](_0x7fcdf2['slice'](0x7),JWT_SECRET),_0x271d43();}catch{return _0x3305cd['status'](0x191)[_0x433715(0xb1)]({'error':_0x433715(0xa2)});}}app[_0x372a40(0xcd)](_0x372a40(0xb0),async(_0x2960db,_0x383549)=>{const _0x5b2628=_0x372a40;let {code:_0x4d65c0,pass:_0x53213e}=_0x2960db[_0x5b2628(0xc1)];if(!_0x4d65c0||!_0x53213e)return _0x383549[_0x5b2628(0xad)](0x190)[_0x5b2628(0xb1)]({'error':'code\x20and\x20pass\x20required'});_0x4d65c0=normalizeDigits(String(_0x4d65c0)[_0x5b2628(0xcc)]()),_0x53213e=normalizeDigits(String(_0x53213e)['trim']());try{const {headers:_0x520c05,data:_0x5c8065}=await readSheet(_0x5b2628(0x9c)),_0xf65801=_0x520c05['indexOf'](_0x5b2628(0xa8)),_0x5dec73=_0x520c05[_0x5b2628(0xd7)]('ÙƒÙ„Ù…Ø©\x20Ø§Ù„Ù…Ø±ÙˆØ±'),_0x2ba397=_0x520c05[_0x5b2628(0xd7)](_0x5b2628(0x86)),_0x229180=_0x5c8065['find'](_0x1cb6c7=>{const _0x2536c5=_0x5b2628,_0x19dde1=normalizeDigits(String(_0x1cb6c7[_0xf65801]??'')[_0x2536c5(0xcc)]()),_0x47f6e9=normalizeDigits(String(_0x1cb6c7[_0x5dec73]??'')['trim']());return _0x19dde1===_0x4d65c0&&_0x47f6e9===_0x53213e;});if(!_0x229180)return _0x383549['status'](0x191)[_0x5b2628(0xb1)]({'error':_0x5b2628(0x85)});const _0x758dae={'code':_0x4d65c0,'name':_0x229180[_0x2ba397]},_0x49439c=jwt['sign'](_0x758dae,JWT_SECRET,{'expiresIn':'12h'});_0x383549[_0x5b2628(0xb1)]({'token':_0x49439c,'user':_0x758dae});}catch(_0x45077e){console['error'](_0x45077e),_0x383549['status'](0x1f4)[_0x5b2628(0xb1)]({'error':_0x5b2628(0x89)});}}),app[_0x372a40(0xa0)](_0x372a40(0x91),authenticate,async(_0x344cac,_0x50ce29)=>{const _0x1d36a2=_0x372a40;try{const {headers:_0x4e6f6b,data:_0x15f5cd}=await readSheet(_0x1d36a2(0xb8)),_0x393e2e=_0x4e6f6b[_0x1d36a2(0xd7)](_0x1d36a2(0xbf)),_0x5c64b1=normalizeDigits(String(_0x344cac[_0x1d36a2(0x7d)][_0x1d36a2(0xca)])['trim']()),_0x4fd26a=_0x15f5cd[_0x1d36a2(0xc6)](_0x55a943=>normalizeDigits(String(_0x55a943[_0x393e2e]??'')[_0x1d36a2(0xcc)]())===_0x5c64b1),_0x4cf7bc=_0x4e6f6b[_0x1d36a2(0xd7)]('ØªÙ†Ø¨ÙŠÙ‡Ø§Øª\x20ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§Øª\x20Ø¹Ø§Ù…Ø©');let _0x41c94d='';if(_0x4cf7bc!==-0x1){const _0x2c27c9=_0x15f5cd[_0x1d36a2(0xa9)](_0x3f22a9=>_0x3f22a9[_0x4cf7bc]?.[_0x1d36a2(0xcc)]());_0x2c27c9&&(_0x41c94d=_0x2c27c9[_0x4cf7bc][_0x1d36a2(0xcc)]());}_0x50ce29['json']({'headers':_0x4e6f6b,'data':_0x4fd26a,'generalNote':_0x41c94d});}catch(_0x2fcb40){console['error'](_0x2fcb40),_0x50ce29['status'](0x1f4)[_0x1d36a2(0xb1)]({'error':_0x2fcb40[_0x1d36a2(0xd5)]});}}),app[_0x372a40(0xa0)](_0x372a40(0x91),authenticate,async(_0x4ae327,_0x42fac6)=>{const _0x50f9d9=_0x372a40;try{const {headers:_0x111120,data:_0x291925}=await readSheet(_0x50f9d9(0xb8)),_0x4afb90=_0x111120[_0x50f9d9(0xd7)](_0x50f9d9(0xbf)),_0x4f5420=normalizeDigits(String(_0x4ae327['user'][_0x50f9d9(0xca)])[_0x50f9d9(0xcc)]()),_0x5d2022=_0x291925[_0x50f9d9(0xc6)](_0x4f5aa7=>normalizeDigits(String(_0x4f5aa7[_0x4afb90]??'')[_0x50f9d9(0xcc)]())===_0x4f5420),_0x13d077=_0x291925[_0x50f9d9(0xc6)](_0x132fac=>!_0x132fac[_0x4afb90]?.[_0x50f9d9(0xa1)]()[_0x50f9d9(0xcc)]()),_0x38d834=_0x111120['indexOf'](_0x50f9d9(0xaf)),_0x561a54=_0x13d077[0x0]?.[_0x38d834]?.[_0x50f9d9(0xcc)]()||'';_0x42fac6[_0x50f9d9(0xb1)]({'headers':_0x111120,'data':_0x5d2022,'generalNote':_0x561a54});}catch(_0x599a5a){console[_0x50f9d9(0xbb)](_0x599a5a),_0x42fac6[_0x50f9d9(0xad)](0x1f4)[_0x50f9d9(0xb1)]({'error':_0x599a5a[_0x50f9d9(0xd5)]});}}),app[_0x372a40(0xa0)](_0x372a40(0xaa),authenticate,async(_0x211f97,_0x2ac75e)=>{const _0x382744=_0x372a40;try{const {headers:_0x4d6ee,data:_0x517c4e}=await readSheet('hwafez'),_0x1f3b89=_0x4d6ee['indexOf']('Ø±Ù‚Ù…\x20Ø§Ù„Ù…ÙˆØ¸Ù'),_0xb4f748=normalizeDigits(String(_0x211f97[_0x382744(0x7d)][_0x382744(0xca)])[_0x382744(0xcc)]()),_0x1e4724=_0x517c4e[_0x382744(0xc6)](_0x1921ed=>normalizeDigits(String(_0x1921ed[_0x1f3b89]??'')['trim']())===_0xb4f748);_0x2ac75e[_0x382744(0xb1)]({'headers':_0x4d6ee,'data':_0x1e4724});}catch(_0x223a73){console['error'](_0x223a73),_0x2ac75e[_0x382744(0xad)](0x1f4)[_0x382744(0xb1)]({'error':_0x223a73[_0x382744(0xd5)]});}}),app['get'](_0x372a40(0xbd),authenticate,async(_0x370768,_0x1fcd6c)=>{const _0x130135=_0x372a40;try{const {headers:_0x4630b2,data:_0x1c6fff}=await readSheet(_0x130135(0xd1)),_0x26dc47=_0x4630b2[_0x130135(0xd7)]('Ø±Ù‚Ù…\x20Ø§Ù„Ù…ÙˆØ¸Ù'),_0x133abf=normalizeDigits(String(_0x370768[_0x130135(0x7d)][_0x130135(0xca)])[_0x130135(0xcc)]()),_0x1e16f1=_0x1c6fff[_0x130135(0xc6)](_0x7249b5=>normalizeDigits(String(_0x7249b5[_0x26dc47]??'')['trim']())===_0x133abf);_0x1fcd6c[_0x130135(0xb1)]({'headers':_0x4630b2,'data':_0x1e16f1});}catch(_0x18692c){console[_0x130135(0xbb)](_0x18692c),_0x1fcd6c['status'](0x1f4)[_0x130135(0xb1)]({'error':_0x18692c[_0x130135(0xd5)]});}});const tokens=new Map();app[_0x372a40(0xcd)](_0x372a40(0xc4),(_0x298b20,_0xca636e)=>{const _0x8b6578=_0x372a40,{user:_0x5bbda3,token:_0x2b3aea}=_0x298b20[_0x8b6578(0xc1)];if(!_0x5bbda3||!_0x2b3aea)return _0xca636e[_0x8b6578(0xad)](0x190)[_0x8b6578(0xb1)]({'error':_0x8b6578(0x99)});tokens['set'](_0x2b3aea,_0x5bbda3),_0xca636e['json']({'success':!![]});}),app[_0x372a40(0xcd)](_0x372a40(0x7f),authenticate,async(_0x5d62ec,_0x11b669)=>{const _0x3d2cc9=_0x372a40;if(_0x5d62ec[_0x3d2cc9(0x7d)][_0x3d2cc9(0xca)]!==SUPERVISOR_CODE)return _0x11b669[_0x3d2cc9(0xad)](0x193)[_0x3d2cc9(0xb1)]({'error':'Forbidden'});const {title:_0x1f38ce,body:_0x3ff663}=_0x5d62ec[_0x3d2cc9(0xc1)],_0x397cad=Array[_0x3d2cc9(0xa5)](tokens[_0x3d2cc9(0xb4)]());await Promise[_0x3d2cc9(0x7c)](_0x397cad[_0x3d2cc9(0xcb)](_0x1ff1e4=>sendPushTo(_0x1ff1e4,_0x1f38ce,_0x3ff663))),_0x11b669[_0x3d2cc9(0xb1)]({'success':!![]});});const userNotifications={};app[_0x372a40(0xcd)]('/api/notifications',authenticate,(_0x1ac7d2,_0x3519a2)=>{const _0x57a853=_0x372a40,{title:_0x1bfedc,body:_0x4e44d4,time:_0x11e2f8}=_0x1ac7d2[_0x57a853(0xc1)];if(!_0x1bfedc||!_0x4e44d4||!_0x11e2f8)return _0x3519a2['status'](0x190)['json']({'error':'Missing\x20fields'});const _0x352086=_0x1ac7d2[_0x57a853(0x7d)][_0x57a853(0xca)];userNotifications[_0x352086]=userNotifications[_0x352086]||[],userNotifications[_0x352086][_0x57a853(0x98)]({'title':_0x1bfedc,'body':_0x4e44d4,'time':_0x11e2f8});if(userNotifications[_0x352086][_0x57a853(0x8f)]>0x32)userNotifications[_0x352086]['pop']();_0x3519a2[_0x57a853(0xb1)]({'success':!![]});}),app['get'](_0x372a40(0x82),authenticate,(_0x252d0b,_0x143eac)=>{const _0x3c015d=_0x372a40,_0x242777=_0x252d0b[_0x3c015d(0x7d)][_0x3c015d(0xca)];_0x143eac[_0x3c015d(0xb1)]({'notifications':userNotifications[_0x242777]||[]});}),app['get']('/api/version',(_0x4265e5,_0x593162)=>{const _0x2815aa=_0x372a40;_0x593162[_0x2815aa(0xb1)]({'version':APP_VERSION});}),app[_0x372a40(0xa0)](/.*/,(_0x2d83c2,_0x309572)=>_0x309572[_0x372a40(0xd8)](path[_0x372a40(0xb9)](__dirname,_0x372a40(0x7e),'index.html')));const PORT=process[_0x372a40(0x95)][_0x372a40(0xc5)]||0xbb8;app[_0x372a40(0xb7)](PORT,()=>console['log'](_0x372a40(0x9b)+PORT));
